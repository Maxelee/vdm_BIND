[TRAINING]
# ==============================================================================
# CleanVDM - AGGRESSIVE Configuration for Stellar Channel
# ==============================================================================
# 
# This is a more aggressive configuration that prioritizes stellar quality.
# Use this if the moderate config (clean_vdm_deep_stellar_focus.ini) isn't
# showing enough improvement on stellar.
#
# Key differences from moderate config:
#   1. EVEN DEEPER: 6 blocks 
#   2. EVEN WIDER: 96 embedding dim
#   3. STRONGER STELLAR WEIGHT: 3x (instead of 2x)
#   4. HIGHER FOCAL GAMMA: 3.0 (more focus on hard examples)
#   5. HIGHER PEAK LR: 2e-4 with careful warmup
#   6. PER-CHANNEL LEARNED NOISE (more flexible)
#
# WARNING: This config uses ~20-25 GB VRAM. Reduce batch_size if needed.
# ==============================================================================

seed = 8
dataset = IllustrisTNG
data_root = /mnt/home/mlee1/ceph/train_data_rotated2_128_cpu/train/
field = gas
boxsize = 6.25 

# ==============================================================================
# TRAINING HYPERPARAMETERS
# ==============================================================================

# Smaller batch due to larger model
batch_size = 128  
num_workers = 40
cropsize = 128
max_epochs = 250

# ==============================================================================
# LEARNING RATE - AGGRESSIVE
# ==============================================================================

learning_rate = 5e-5 
lr_scheduler = cosine_warmup 

# ==============================================================================
# VDM NOISE SCHEDULE
# ==============================================================================

# Try learned_nn for maximum flexibility
# This learns a full neural network noise schedule as per VDM paper
noise_schedule = learned_nn  
gamma_min = -13.3
gamma_max = 13.0

# ==============================================================================
# DATA AUGMENTATION
# ==============================================================================

# Aggressive per-channel noise
data_noise = 5e-4, 5e-4, 5e-4
antithetic_time_sampling = True

# ==============================================================================
# ARCHITECTURE - DEEP AND WIDE
# ==============================================================================

# VERY DEEP: 6 blocks
n_blocks = 5

# VERY WIDE: 96 embedding channels
# Channel progression: 96->192->384->768->1024->1024 (capped) at bottleneck
# mid_ch_out = 1024 * 2 = 2048
embedding_dim = 96

norm_groups = 8
# NOTE: n_attention_heads must divide mid_ch_out (2048)
# Valid options: 1, 2, 4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048
n_attention_heads = 8 
large_scale_channels = 3

# ==============================================================================
# CROSS-ATTENTION: DISABLED
# ==============================================================================

use_cross_attention = False

# ==============================================================================
# SELF-ATTENTION: ENABLED
# ==============================================================================

add_attention = True

# ==============================================================================
# FEATURE ENGINEERING
# ==============================================================================

use_fourier_features = True
legacy_fourier = False

# ==============================================================================
# LOSS CONFIGURATION - AGGRESSIVE STELLAR FOCUS
# ==============================================================================

lambdas = 1.0, 1.0, 1.0

# VERY STRONG STELLAR WEIGHT: 3x
channel_weights = 1.0, 1.0, 3.0

# AGGRESSIVE FOCAL LOSS
use_focal_loss = False
focal_gamma = 3.0  

# ==============================================================================
# PARAMETER CONDITIONING
# ==============================================================================

use_param_prediction = True
param_prediction_weight = 0.01
param_norm_path = /mnt/home/mlee1/Sims/IllustrisTNG_extras/L50n512/SB35/SB35_param_minmax.csv

# ==============================================================================
# STELLAR NORMALIZATION
# ==============================================================================

quantile_path = /mnt/home/mlee1/vdm_BIND/quantile_normalizer_stellar.pkl
use_quantile_normalization = True

# ==============================================================================
# MONITORING
# ==============================================================================

validation_plot_frequency = 500
enable_early_stopping = False
enable_fid_monitoring = False
enable_gradient_monitoring = True
gradient_log_frequency = 50

# ==============================================================================
# TRAINING DATA
# ==============================================================================

limit_train_samples = None
limit_val_samples = None
limit_train_batches = 1.0

# ==============================================================================
# LOGGING
# ==============================================================================

model_name = clean_vdm_aggressive_stellar
tb_logs = /mnt/home/mlee1/ceph/tb_logs
version = 3
