[TRAINING]
# ==============================================================================
# Triple CleanVDM - Train Three Separate Single-Channel Models
# ==============================================================================
# 
# This configuration trains THREE SEPARATE models simultaneously:
#   1. Hydro DM model (predicts channel 0: dark matter)
#   2. Gas model (predicts channel 1: gas)
#   3. Stars model (predicts channel 2: stars)
#
# Key advantages over single 3-channel model:
#   - Each model is 3x smaller (1 channel vs 3 channels)
#   - Lower memory footprint per model
#   - Independent specialization per channel
#   - Can use different settings per channel (e.g., focal loss only for stars)
#   - Train all three simultaneously for efficiency
#
# Memory usage: ~3x smaller per model = similar total memory to original
# ==============================================================================

seed = 42
dataset = IllustrisTNG
data_root = /mnt/home/mlee1/ceph/train_data_rotated2_128_cpu/train/
field = gas
boxsize = 6.25 

# ==============================================================================
# TRAINING HYPERPARAMETERS
# ==============================================================================

batch_size = 64
num_workers = 40
cropsize = 128
max_epochs = 200

# ==============================================================================
# LEARNING RATE
# ==============================================================================

learning_rate = 5e-5 
lr_scheduler = cosine_warmup 

# ==============================================================================
# VDM NOISE SCHEDULE
# ==============================================================================

# Each model gets its own noise schedule (learned independently)
noise_schedule = learned_nn  
gamma_min = -13.3
gamma_max = 13.0

# ==============================================================================
# DATA AUGMENTATION
# ==============================================================================

# Single noise value (applied to each model's single channel)
data_noise = 5e-4
antithetic_time_sampling = True

# ==============================================================================
# ARCHITECTURE
# ==============================================================================

# Each model has 5 blocks (same depth as original)
n_blocks = 5

# Each model has 96 embedding dim (same width as original)
embedding_dim = 96

norm_groups = 8
n_attention_heads = 8 
large_scale_channels = 3

# ==============================================================================
# CROSS-ATTENTION: DISABLED (for simplicity)
# ==============================================================================

use_cross_attention = False

# ==============================================================================
# SELF-ATTENTION: ENABLED
# ==============================================================================

add_attention = True

# ==============================================================================
# FEATURE ENGINEERING
# ==============================================================================

use_fourier_features = True
legacy_fourier = False

# ==============================================================================
# LOSS CONFIGURATION
# ==============================================================================

# Loss weights for each VDM model (diffusion, latent, recons)
lambdas = 1.0, 1.0, 1.0

# Channel weights for combining the three model losses
# Stars gets 3x weight to prioritize stellar quality
channel_weights = 1.0, 1.0, 3.0

# ==============================================================================
# FOCAL LOSS (PER CHANNEL)
# ==============================================================================

# Can enable focal loss independently for each channel
use_focal_loss_hydro_dm = False
use_focal_loss_gas = False
use_focal_loss_stars = False 
focal_gamma = 3.0

# ==============================================================================
# PARAMETER CONDITIONING
# ==============================================================================

use_param_prediction = True
param_prediction_weight = 0.01
param_norm_path = /mnt/home/mlee1/Sims/IllustrisTNG_extras/L50n512/SB35/SB35_param_minmax.csv

# ==============================================================================
# STELLAR NORMALIZATION
# ==============================================================================

quantile_path = /mnt/home/mlee1/vdm_BIND/data/quantile_normalizer_stellar.pkl
use_quantile_normalization = True

# ==============================================================================
# MONITORING
# ==============================================================================

validation_plot_frequency = 500
enable_early_stopping = False
enable_fid_monitoring = False
enable_gradient_monitoring = True
gradient_log_frequency = 50

# ==============================================================================
# TRAINING DATA
# ==============================================================================

limit_train_samples = None
limit_val_samples = None
limit_train_batches = 1.0

# ==============================================================================
# LOGGING
# ==============================================================================

model_name = triple_vdm_separate_models
tb_logs = /mnt/home/mlee1/ceph/tb_logs3
version = 0

# ==============================================================================
# SPEED OPTIMIZATIONS
# ==============================================================================
# precision: "32" (default), "16-mixed" (faster on modern GPUs), "bf16-mixed"
# compile_model: Use torch.compile for ~10-30% speedup (requires PyTorch 2.0+)

precision = 16-mixed
compile_model = False
